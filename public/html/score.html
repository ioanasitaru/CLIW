<!DOCTYPE html>
<html lang="en" manifest="../manifest.appcache">
<head>
    <link rel="apple-touch-icon" sizes="57x57" href="../img/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../img/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../img/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../img/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../img/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../img/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../img/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../img/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../img/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../img/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../img/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../img/ms-icon-144x144.png">
    <meta name="theme-color" content="#000000">

    <meta charset="UTF-8">
    <title>Score</title>
    <link href="../css/about.css" rel="stylesheet">
    <link href="../css/score.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="landing">
<div id="page-wrapper">
    <div id="header">
        <a href="#" id="logo-link">
            <img src="../img/logo.png" id="logo" alt="asle-logo">
        </a>
        <!--<div class="vertical-line"></div>-->
        <nav id="nav">
            <ul>
                <li><a href="about.html">Home</a></li>
                <li>
                    <a href="index.html">Practice</a>
                </li>
                <li><a href="score.html">Progress</a></li>
            </ul>
        </nav>
    </div>
    <div id="main" class="wrapper">
    </div>
</div>
<footer>
    <p>
        <i class="fa fa-copyright" aria-hidden="true"></i> ASLE - CLIW 2017
    </p>
</footer>
<script src="../js/score.js"></script>
<script src="../js/score2.js"></script>
<script>
    tweet = function (module_name, score) {
        window.open(
            "https://twitter.com/intent/tweet?hashtags=asle&original_referer=http%3A%2F%2Flocalhost%3A8080%2Fhtml%2Fscore.html&ref_src=twsrc%5Etfw&text=I%20just%20scored%20" + score + "%20in%20" + module_name + "!%20Think%20you%20can%20beat%20me%3F%20Head%20over%20to%20asle.com%2F" + module_name.toLowerCase() + "%20and%20try!",
            "Share your ASLE progress on Twitter!",
            "width=600,height=400,")
    }
</script>
<script>
    function getPerformanceMessage(score) {
        console.log(score);
        let performance = [
            {
                "threshold": "25",
                "message": "It seems you really need more practice"
            },
            {
                "threshold": "50",
                "message": "Way to go"
            },
            {
                "threshold": "75",
                "message": "You are doing pretty good"
            },
            {
                "threshold": "100",
                "message": "You are almost native"
            },
        ];

        for (let i = 0; i < performance.length; i++) {
            if (score < performance[i].threshold) {
                return performance[i].message;
            }
        }
    }

    String.prototype.capitalize = function () {
        return this.charAt(0).toUpperCase() + this.slice(1);
    };

    let insertingDiv = document.getElementById("main");

    fetch("../comp.json")
        .then(response => response.json())
        .then(components => {
            components.forEach((component) => {
                let score = new Score(component.name);
                let history = score.getHistory();
                if (history) {
                    history.positive = 76;
                    history.total = 100;
                    history.maxStreak = 100;
                    history.streak = 80;
                    history.monday = 10;
                    history.tuesday = 20;
                    history.wednesday = 76;
                    history.thursday = 67;
                    history.friday = 56;
                    history.saturday = 45;
                    history.sunday = 22;


                    let container = document.createElement("div");
                    container.className = "container";

                    let header = document.createElement("header");
                    header.className = "major";

                    let message = document.createElement("h2");
                    message.textContent = "Your stats at " + component.name.capitalize();

                    let overallPerformance = document.createElement("p");
                    let performanceMessage = getPerformanceMessage((history.positive / history.total) * 100);
                    overallPerformance.textContent = performanceMessage + "! You have answered correctly " + history.positive + " out of " + history.total;

                    let twitterShare = document.createElement("p");
                    let textBefore = document.createTextNode("Share it on ");
                    let textAfter = document.createTextNode(" with your friends.");
                    let link = document.createElement("a");
                    link.setAttribute("href", "javascript:void(0)");
                    link.className = "twitter";
                    link.addEventListener("click", function () {
                        tweet(component.name, history.positive);
                    });
                    link.textContent = "Twitter";
                    let twitterIcon = document.createElement("i");
                    twitterIcon.className = "fa fa-twitter";
                    twitterIcon.setAttribute("aria-hidden", "true");

                    link.appendChild(twitterIcon);

                    twitterShare.appendChild(textBefore);
                    twitterShare.appendChild(link);
                    twitterShare.appendChild(textAfter);

                    header.appendChild(message);
                    header.appendChild(overallPerformance);
                    header.appendChild(twitterShare);
                    container.appendChild(header);


                    let statsSection = document.createElement("section");
                    statsSection.id = "content2";

                    let title = document.createElement("h3");
                    title.textContent = "Last week performance:";

                    let progress = document.createElement("h5");
                    progress.textContent = history.streak + " of maximum streak of " + history.maxStreak;

                    let currentStreak = document.createElement("h3");
                    currentStreak.textContent = "Current streak";

                    let progressBar = document.createElement("div");
                    progressBar.className = "progress-bar";

                    let pBar = document.createElement("div");
                    pBar.className = "pBar";
                    let width = 1;
                    let id = setInterval(frame, 10);

                    function frame() {
                        if (width >= (history.streak / history.maxStreak) * 100) {
                            clearInterval(id);
                        } else {
                            width++;
                            pBar.style.width = width + '%';
                        }
                    }

                    let linkChart = document.createElement("a");
                    linkChart.className = "image fit";
                    linkChart.setAttribute("href", "#");

                    let chart = document.createElement("div");
                    let chartjson = {
                        "title": "",
                        "data": [{
                            "name": "Monday",
                            "score": history.monday
                        }, {
                            "name": "Tuesday",
                            "score": history.tuesday
                        }, {
                            "name": "Wednesday",
                            "score": history.wednesday
                        }, {
                            "name": "Thursday",
                            "score": history.thursday
                        },
                        {
                            "name": "Friday",
                            "score": history.friday
                        }, {
                            "name": "Saturday",
                            "score": history.saturday
                        }, {
                            "name": "Sunday",
                            "score": history.sunday
                        }],
                        "ymax": Math.max(history.monday, history.tuesday, history.wednesday, history.thursday, history.friday, history.saturday, history.sunday),
                        "ykey": 'score',
                        "xkey": "name",
                        "prefix": "%"
                    };

                    //chart colors
                    let colors = ['five', 'five', 'five', 'five', 'five', 'five', 'five'];

                    //constants
                    let TROW = 'tr',
                        TDATA = 'td';

                    //create the chart draw
                    let barchart = document.createElement('table');
                    chart.appendChild(barchart);

                    //create the bar row
                    let barrow = document.createElement(TROW);
                    barrow.setAttribute('class', 'bars');

                    //lets add data to the chart
                    for (let i = 0; i < chartjson.data.length; i++) {
                        let prefix = '';
                        //create the bar data
                        let bardata = document.createElement(TDATA);
                        let bar = document.createElement('div');
                        bar.setAttribute('class', 'bar ' + colors[i]);
                        bar.style.height = chartjson.data[i][chartjson.ykey] + "%";
                        bardata.innerText = chartjson.data[i][chartjson.ykey] + prefix;
                        bardata.appendChild(bar);

                        let legbox = document.createElement('span');
                        legbox.setAttribute('class', 'legbox');
                        bardata.appendChild(legbox);
                        let bartext = document.createElement('span');
                        bartext.innerText = chartjson.data[i][chartjson.xkey];
                        legbox.appendChild(bartext);

                        barrow.appendChild(bardata);
                    }

                    barchart.appendChild(barrow);
                    chart.appendChild(barchart);

                    linkChart.appendChild(chart);
                    progressBar.appendChild(pBar);

                    statsSection.appendChild(title);
                    statsSection.appendChild(currentStreak);
                    statsSection.appendChild(progressBar);
                    statsSection.appendChild(progress);
                    statsSection.appendChild(linkChart);


                    insertingDiv.appendChild(container);
                    insertingDiv.appendChild(statsSection);
                }
            });
        });
</script>
</body>
</html>